<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>圖片輪播3</title>
    <style>
        .carousel {
            margin: auto;
            position: relative;
            width: 600px;
            /* 符合比例 */
            aspect-ratio: 16/9;
            overflow: hidden;

            & img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

            .image1 {
                position: absolute;
                width: 100%;
                height: 100%;
                left: 0;
                top: 0;
                opacity: 0;
                transition: all 0.5s;
            }
            .active1 {
                opacity: 1;
            }

            .image2 {
                position: absolute;
                width: 100%;
                height: 100%;
                left: 0;
                top: 0;
                opacity: 0;
                transition: all 0.5s;
                transform: translateX(-100%) rotate(30deg);
            }

            .active2 {
                opacity: 1;
                transform: translateX(0%) rotate(0deg);
            }
        }

        .pagination{
            margin: 20px auto;
            width: 200px;
            display: flex;
            justify-content: space-between;
            position: relative;
            .page{
                cursor: pointer;
                width: 15px;
                height: 15px;
                border-radius: 50%;
                background-color: rgb(197, 197, 197);
            }
            .active{
                background-color: lightblue;
            }

            .ctrl {
                width: 680px;
                position: absolute;
                bottom: calc((600px / 16 * 9) / 2 + 15px);
                /* 頁碼200px + 單邊icon 40px */
                left: -240px;
                display: flex;
                justify-content: space-between;
                & i{
                    cursor: pointer;
                    color: rgb(255, 255, 255);
                    -webkit-text-stroke: 2px #0000004f;
                }
            }
        }

        .animation{
            width: 200px;
            margin: auto;
            display: flex;
            justify-content: space-between;
            .btn{
                padding: 5px 10px;
                color: rgb(255, 255, 255);
                text-align: center;
                cursor: pointer;
            }
            .btn1{
                background-color: rgb(255, 179, 179);
                &:hover{
                    background-color: rgb(255, 116, 116);
                }
            }
            .btn2{
                background-color: rgb(143, 203, 254);
                &:hover{
                    background-color: rgb(62, 160, 245);
                }
            }
        }
    </style>
</head>

<body>
    <div class="carousel">
        <div class="image1 active1">
            <img src="https://images.pexels.com/photos/1023953/pexels-photo-1023953.jpeg?auto=compress&cs=tinysrgb&w=600"
                alt="" />
        </div>
        <div class="image1">
            <img src="https://images.pexels.com/photos/992734/pexels-photo-992734.jpeg?auto=compress&cs=tinysrgb&w=600"
                alt="" />
        </div>
        <div class="image1">
            <img src="https://images.pexels.com/photos/673847/pexels-photo-673847.jpeg?auto=compress&cs=tinysrgb&w=600"
                alt="" />
        </div>
        <div class="image1">
            <img src="https://images.pexels.com/photos/2058853/pexels-photo-2058853.jpeg?auto=compress&cs=tinysrgb&w=600"
                alt="" />
        </div>
        <div class="image1">
            <img src="https://images.pexels.com/photos/2004630/pexels-photo-2004630.jpeg?auto=compress&cs=tinysrgb&w=600"
                alt="" />
        </div>
    </div>
    <div class="pagination">
        <div class="ctrl">
            <div id="prev"><i class="fa-solid fa-chevron-left fa-4x"></i></div>
            <div id="next"><i class="fa-solid fa-chevron-right fa-4x"></i></div>
        </div>
        <div class="page active" id="1"></div>
        <div class="page" id="2"></div>
        <div class="page" id="3"></div>
        <div class="page" id="4"></div>
        <div class="page" id="5"></div>
    </div>
    <div class="animation">
        <div class="btn btn1">淡入淡出</div>
        <div class="btn btn2">旋入旋出</div>
    </div>

    <script>
        // 預設淡入淡出
        let mode = 1;
        $(".btn1").on("click", ()=>{
            mode = 1;
            $(".image2").addClass("image1");
            $(".active2").addClass("active1");
            $(".image2").removeClass("image2").removeClass("active2");
            resetTimeInterval(mode);
        })

        $(".btn2").on("click", ()=>{
            mode = 2;
            $(".image1").addClass("image2");
            $(".active1").addClass("active2");
            $(".image1").removeClass("image1").removeClass("active1");
            resetTimeInterval(mode);
        })

        // 自動輪播: 設定變數儲存函式，後續才能使用clearInterval()清空計時器
        // 傳入參數指定轉場模式
        function setTimeInterval(mode){
            console.log(mode);
            return setInterval(() => {
                let current = $(`.image${mode}.active${mode}`);
                current.removeClass(`active${mode}`);
                // 若沒有下一張，則回到第一張圖
                let next = current.next(`.image${mode}`).length
                    ? current.next(`.image${mode}`)
                    : $(`.image${mode}`).first();
                next.addClass(`active${mode}`);

                // 連動頁碼
                let pageNow = $(".page.active");
                pageNow.removeClass("active");
                let nextPage =  pageNow.next(".page").length ? pageNow.next(".page") : $(".page").first();
                nextPage.addClass("active");
            }, 2500);
        }
        let timeInterval = setTimeInterval(mode);
        // 重啟計時器
        function resetTimeInterval(mode){
            clearInterval(timeInterval);
            timeInterval = setTimeInterval(mode);
        }

        $("#next").on("click", () => {
            clearInterval(timeInterval);
            let current = $(`.image${mode}.active${mode}`);
            current.removeClass(`active${mode}`);
            // 若沒有下一張，則回到第一張圖
            let next = current.next(`.image${mode}`).length
                ? current.next(`.image${mode}`)
                : $(`.image${mode}`).first();
            next.addClass(`active${mode}`);

            // 連動頁碼
            let pageNow = $(".page.active");
            pageNow.removeClass("active");
            let nextPage =  pageNow.next(".page").length ? pageNow.next(".page") : $(".page").first();
            nextPage.addClass("active");
            resetTimeInterval(mode);
        });

        $("#prev").on("click", () => {
            clearInterval(timeInterval);
            let current = $(`.image${mode}.active${mode}`);
            current.removeClass(`active${mode}`);
            // 若沒有上一張，則回到最後一張圖
            let prev = current.prev(`.image${mode}`).length
                ? current.prev(`.image${mode}`)
                : $(`.image${mode}`).last();
            prev.addClass(`active${mode}`);

            // 連動頁碼
            let pageNow = $(".page.active");
            pageNow.removeClass("active");
            let nextPage =  pageNow.prev(".page").length ? pageNow.prev(".page") : $(".page").last();
            nextPage.addClass("active");
            resetTimeInterval(mode);
        });

        let pageNum = 0;
        $(".page").on("click", function(){
            // 清空計時器
            clearInterval(timeInterval);
            // 沒有active的頁碼，點了才有反應
            if($(this).hasClass("active") === false){
                // 先清空active
                $(".page").removeClass("active");
                $(this).addClass("active");
                pageNum = parseInt($(this).attr("id"));
                // console.log(pageNum);
                let current = $(`.image${mode}.active${mode}`);
                current.removeClass(`active${mode}`);
                // console.log($(".carousel .image").eq(pageNum));
                $(`.image${mode}`).eq(pageNum-1).addClass(`active${mode}`);
                resetTimeInterval(mode);
            }
        })
        
    </script>
</body>

</html>