<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>圖片輪播2</title>
    <style>
        .carousel {
            margin: auto;
            position: relative;
            width: 60%;
            /* 符合比例 */
            aspect-ratio: 16/9;
            .image {
                position: absolute;
                width: 100%;
                height: 100%;
                left: 0;
                top: 0;
                opacity: 0;
                transition: all 0.5s;
                & img {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                }
            }
            .active {
                opacity: 1;
            }
        }

        .ctrl {
            width: calc(100% + 80px);
            position: absolute;
            left: -40px;
            top: calc(100% / 2);
            transform: translateY(-32px);
            z-index: 10;
            display: flex;
            justify-content: space-between;
            & i{
                cursor: pointer;
                color: rgb(255, 255, 255);
                -webkit-text-stroke: 2px #0000004f;
                /* font-size: xx-large; */
            }
        }

        .pagination{
            margin: 20px auto;
            width: 15%;
            display: flex;
            justify-content: space-between;
            .page{
                cursor: pointer;
                width: 15px;
                height: 15px;
                border-radius: 50%;
                background-color: rgb(197, 197, 197);
            }
            .active{
                background-color: lightblue;
            }
        }
    </style>
</head>

<body>
    <div class="carousel">
        <div class="ctrl">
            <div id="prev"><i class="fa-solid fa-chevron-left fa-4x"></i></div>
            <div id="next"><i class="fa-solid fa-chevron-right fa-4x"></i></div>
        </div>
        <div class="image active">
            <img src="https://images.pexels.com/photos/1023953/pexels-photo-1023953.jpeg?auto=compress&cs=tinysrgb&w=600"
                alt="" />
        </div>
        <div class="image">
            <img src="https://images.pexels.com/photos/992734/pexels-photo-992734.jpeg?auto=compress&cs=tinysrgb&w=600"
                alt="" />
        </div>
        <div class="image">
            <img src="https://images.pexels.com/photos/673847/pexels-photo-673847.jpeg?auto=compress&cs=tinysrgb&w=600"
                alt="" />
        </div>
        <div class="image">
            <img src="https://images.pexels.com/photos/2058853/pexels-photo-2058853.jpeg?auto=compress&cs=tinysrgb&w=600"
                alt="" />
        </div>
        <div class="image">
            <img src="https://images.pexels.com/photos/2004630/pexels-photo-2004630.jpeg?auto=compress&cs=tinysrgb&w=600"
                alt="" />
        </div>
    </div>
    <div class="pagination">
        <div class="page active" id="1"></div>
        <div class="page" id="2"></div>
        <div class="page" id="3"></div>
        <div class="page" id="4"></div>
        <div class="page" id="5"></div>
    </div>

    <script>
        // 自動輪播: 設定變數儲存函式，後續才能使用clearInterval()清空計時器
        function setTimeInterval(){
            return setInterval(() => {
                let current = $(".image.active");
                current.removeClass("active");
                // 若沒有下一張，則回到第一張圖
                let next = current.next(".image").length
                    ? current.next(".image")
                    : $(".image").first();
                next.addClass("active");

                // 連動頁碼
                let pageNow = $(".page.active");
                pageNow.removeClass("active");
                let nextPage =  pageNow.next(".page").length ? pageNow.next(".page") : $(".page").first();
                nextPage.addClass("active");
            }, 2500);
        }
        let timeInterval = setTimeInterval();
        // 重啟計時器
        function resetTimeInterval(){
            clearInterval(timeInterval);
            timeInterval = setTimeInterval();
        }

        $("#next").on("click", () => {
            clearInterval(timeInterval);
            let current = $(".image.active");
            current.removeClass("active");
            // 若沒有下一張，則回到第一張圖
            let next = current.next(".image").length
                ? current.next(".image")
                : $(".image").first();
            next.addClass("active");

            // 連動頁碼
            let pageNow = $(".page.active");
            pageNow.removeClass("active");
            let nextPage =  pageNow.next(".page").length ? pageNow.next(".page") : $(".page").first();
            nextPage.addClass("active");
            resetTimeInterval();
        });

        $("#prev").on("click", () => {
            clearInterval(timeInterval);
            let current = $(".image.active");
            current.removeClass("active");
            // 若沒有上一張，則回到最後一張圖
            let prev = current.prev(".image").length
                ? current.prev(".image")
                : $(".image").last();
            prev.addClass("active");

            // 連動頁碼
            let pageNow = $(".page.active");
            pageNow.removeClass("active");
            let nextPage =  pageNow.prev(".page").length ? pageNow.prev(".page") : $(".page").last();
            nextPage.addClass("active");
            resetTimeInterval();
        });

        let pageNum = 0;
        $(".page").on("click", function(){
            // 清空計時器
            clearInterval(timeInterval);
            // 沒有active的頁碼，點了才有反應
            if($(this).hasClass("active") === false){
                // 先清空active
                $(".page").removeClass("active");
                $(this).addClass("active");
                pageNum = parseInt($(this).attr("id"));
                // console.log(pageNum);
                let current = $(".image.active");
                current.removeClass("active");
                // console.log($(".carousel .image").eq(pageNum));
                $(".carousel .image").eq(pageNum-1).addClass("active");
                resetTimeInterval();
            }
        })
    </script>
</body>

</html>